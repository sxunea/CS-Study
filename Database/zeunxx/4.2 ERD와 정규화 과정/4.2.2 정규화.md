# 정규화

정규화 과정은 릴레이션 간의 잘못된 종속 관계로 인해 데이터 베이스 이상 현상이 일어나 이를 해결하거나, 저장공간을 효율적으로 사용하기 위해 릴레이션을 여러개로 분리하는 과정

<br>

## 💡 이상현상 Anomaly

1. 삭제 이상: 튜플 삭제시 같이 저장된 다른 정보까지 연쇄적으로 삭제
2. 삽입 이상: 튜플 삽입을 위해 불필요한 데이터도 함께 삽입해야 함
3. 갱신 이상: 중복 튜플 중 일부만 변경돼 데이터가 불일치


<br>

- 이러한 이상 현상을 제거하기 위해 릴레이션을 **분해**한다. 이때,  **함수적 종속성**을 판단해 정규화를 진행한다.


<BR>

### ❓ 함수적 종속성
속성들간의 관련성, DB에서 속성들간의 종속관계

- 데이터베이스의 릴레이션 R에서 X와 Y를 R의 부분집합이라고 할 때, X의 값 각가에 대해 Y의 값이 오직 하나로 결정될때는 Y는 X에 종속된다고 한다.
- X = 결정자, Y = 종속자
- 정규화가 잘 된 테이블일 수록 결정자 X는 PK로 한개이고, 종속자가 여러개인 구조를 가짐

<BR>

1. 완전함수종속

    종속자가 기본키에만 종속되며, 기본키가 여러 속성으로 구성되어 있을 경우 기본키를 구성하는 모든 속성이 포함된 기본키의 부분집합에 종속된 경우

    ![image](https://github.com/zeunxx/algorithm/assets/81572478/f0e4912f-de16-4dbf-b813-d20de073ae1b)
    - 여기선 주민번호만 다른 속성을 결정할 수 있음
    - 850811-2... 인 주민번호는 이름이 성춘향이고, 여성에 서울을 산다 
    - BUT 이름이 성춘향인 사람은 두명이 있어서 다른 속성 결정 불가

<BR>

2. 부분함수종속

    릴레이션에서 기본키가 복합키일 경우 기본키를 구성하는 속성 중 일부에게 종속된 경우

    ![image](https://github.com/zeunxx/algorithm/assets/81572478/5de89516-c819-465f-97fb-0edad36d9a98)
    - 위에서 기본키는 (이름, 성별)
    - (이름, 성별)이 다른 속성을 결정함
    - BUT 기본키의 부분집합인 이름에 대해 (이름) -> (주소) 결정함

<BR>

3. 이행함수종속

    릴레이션에서 X,Y,Z라는 3개의 속성이 있을때 X→Y, Y→Z 란 종속 관계가 있을 때, X→Z가 성립하는 경우
    - 위 테이블에서 X(이름, 성별) -> Y(주소), X(이름,성별) -> Z(지역번호) 관계를 알았을때,
    - Y(주소) -> Z(지역번호)의 관계도 성립합니다. 

<br>

## 제1 정규화

테이블의 컬럼이 원자값(하나의 값)을 갖도록 테이블을 분리하는 것

![image](https://github.com/zeunxx/algorithm/assets/81572478/803320e2-4c9e-49a9-86a0-0db98081856e)
위 테이블에서 추신수와 박세리는 여러개의 취미를 가지므로 제1 정규형 만족 X

<BR>


![image](https://github.com/zeunxx/algorithm/assets/81572478/02145369-3f3e-4dcd-bbc7-b0b21f65d183)
따라서 취미를 각 튜플에 분리해서 정규화 진행




<br>

## 제2 정규화

제1 정규화를 진행한 테이블에 대해 완전함수종속을 만족하도록 테이블을 분해하는 것
- 완전함수종속: 기본키의 부분집합이 결정자가 되어선 안된다는 것


![image](https://github.com/zeunxx/algorithm/assets/81572478/90ac65c3-9875-440d-804f-afbdd751a147)
- 이 테이블에서 기본키는 (학생번호, 강좌이름)으로 복합키이다. 
- (학생번호, 강좌이름)인 기본키는 성적을 결정하고 있다. (학생번호, 강좌이름) -> (성적) 
- BUT 여기서 (강의실)은 기본키의 부분집합인 강좌이름에 의해 결정될 수 있다. (강좌이름) -> (강의실)


<br>

![image](https://github.com/zeunxx/algorithm/assets/81572478/596faea2-b9d7-45c0-80ec-9f475a6efc5f)
따라서 기존의 테이블에서 강의실을 분해해 별도의 테이블로 관리해 정규화 진행




<BR>

## 제3 정규화

제2 정규화를 진행한 테이블에 대해 이행적 종속을 없애도록 테이블을 분해하는 것
- 이행적 종속: A→B, B→C가 성립할때, A→C가 성립하는 것


![image](https://github.com/zeunxx/algorithm/assets/81572478/845d2257-baf1-4f9c-beb7-3bb683e98e89)
- (학생번호)는 (강좌이름) 결정, (강좌이름)은 (수강료)를 결정함


<BR>

![image](https://github.com/zeunxx/algorithm/assets/81572478/aba8a466-f97e-4fc1-b2f3-a02e02809081)
따라서 (학생번호, 강좌이름) 테이블과 (강좌이름, 수강료) 테이블로 분해



<BR>

## BCNF 정규화

제3 정규화를 진행한 테이블에 대해 모든 결정자가 후보키가 되도록 테이블을 분해하는 것

![image](https://github.com/zeunxx/algorithm/assets/81572478/29fc7d70-a0e9-463d-b697-00908583cde6)
- 특강수강 테이블에서 기본키는 (학생번호, 특강이름)
- 그리고 기본키 (학생번호, 특강이름)는 교수를 결정. 또한 여기서 교수는 특강이름을 결정
- 문제는 교수가 특강이름을 결정하는 결정자인데, 후보키가 아님

<BR>

![image](https://github.com/zeunxx/algorithm/assets/81572478/f53ec56c-ce7e-4a60-93f2-ee5836355d5c)
따라서 테이블을 특강신청 테이블과 특강교수 테이블로 분해
- 교수는 결정자이면서 특강 교수 테이블에서 후보키이자 기본키가 됨