# 3.3.6 공유자원과 임계영역

**공유자원**은 시스템 안에서 각 프로세스, 스레드가 함께 접근할 수 있는 모니터, 프린터, 메모리, 파일, 데이터 등의 자원이나 변수 등을 말한다.

이 공유 자원을 두 개 이상의 프로세스가 동시에 읽거나 쓰이는 상황을 **경쟁 상태**(race condition)라고 한다. 이 때문에 접근의 타이밍이나 순서 등이 결과값에 영향을 준다.

## 임계 영역

앞서 말한대로, 멀티 스레드는 여러 개의 스레드가 공유 자원에 동시에 접근할 수 있기 때문에, **동기화 문제**가 발생할 수 있다. 동기화 작업은 여러 스레드들이 자원에 대한 접근을 순차적으로 통제하는 방법으로, 그러면 동시 접근으로 인한 동시 수정과 같은 현상은 일어나지 않게 된다. 

이를 해결하기 위해 **임계 영역**에 대해 크게 **뮤텍스, 세마포어, 모니터**라는 방법으로 해결하고, 이 세가지 방법 모두 상호 배제, 한정 대기, 융통성이라는 조건을 만족한다. 

**임계 영역**
- 둘 이상의 프로세스, 스레드가 공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 코드 영역

**상호 배제**
- 한 프로세스가 임계 영역에 들어갔을 때 다른 프로세스는 들어갈 수 없다

**한정 대기**
- 특정 프로세스가 영원히 임계 영역에 들어가지 못하면 안된다

**융통성**
- 한 프로세스가 다른 프로세스의 일을 방해해서는 안된다

### 뮤텍스

![image](https://github.com/sxunea/CS-Study/assets/81434152/6c9d5a85-d5e3-4347-9f38-3bfaf61b5032)

뮤텍스는 프로세스나 스레드가 공유 자원을 lock()을 통해 잠금 설정하고 사용한 후에는 unlock()을 통해 잠금 해제하는 방식이다

### 세마포어 

![image](https://github.com/sxunea/CS-Study/assets/81434152/e3e9c2c1-7699-4162-b03d-49ead2225bf3)

세마포어는 일반화된 뮤텍스이다

간단한 정수값과 두가지 함수 wait, signal로 공유 자원에 대한 접근을 처리한다. wait()는 자기 차례가 올 때까지 기다리는 함수이며, signal()은 다음 프로세스로 순서를 넘겨주는 함수이다

이를 통해 프로세스나 스레드가 공유자원에 접근하면 wait()가 수행되고, 자원을 해제하면 signal()이 수행된다. 세마포어 값을 수정할 때 다른 프로세스나 스레드는 동시에 세마포어 값을 수정할 수 없다

### 모니터 

이는 둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유자원을 숨기고, 해당 접근에 대해 인터페이스만을 제공한다.

