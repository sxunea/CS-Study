# 3.3.5 멀티 프로세스와 멀티 스레드

## 멀티 프로세스 

**멀티 프로세싱**은 여러개의 프로세스를 통해 동시에 두가지 이상의 일을 수행할 수 있는 것을 말한다. 보통 하나의 프로그램 실행에 대해 하나의 프로세스가 메모리에 생성되지만, 부가적인 기능을 위해 여러개의 프로세스를 생성하는 것이다. 이를 통해 **하나 이상의 일을 병렬**로 처리할 수 있으며 특정 프로세스의 메모리, 프로세스 중 일부에 문제가 발생되더라도 다른 프로세스를 이용해서 처리할 수 있으므로 신뢰성이 높은 강점이 있다

![image](https://github.com/sxunea/CS-Study/assets/81434152/44cfea3a-3727-42ba-850e-5947b7e74ec3)


부모 프로세스와 자식 프로세스는 각각 고유한 **PID**(Process ID)를 가지고 있다. 부모 프로세스는 자식 프로세스의 PID를 알고 있으며, 이를 통해 자식 프로세스를 제어할 수 있다. 또한, 자식 프로세스는 부모 프로세스의 PID와 PPID(Parent Process ID)를 알고 있어, **이를 통해 부모 프로세스와의 통신**이 가능하다.


## IPC
**IPC**는 프로세스끼리 **데이터를 주고받고 공유 데이터를 관리**하는 매커니즘을 말한다. 각 프로세스는 별도의 공간에서 실행되기 때문에, 한 프로세스에서 다른 프로세스의 메모리영역에 접근할 수 없다. 만약 프로세스가 다른 프로세스 자원에 접근하려면 IPC(Inter-Process Commnuication)를 사용해야 한다. 

이때, IPC는 공유 메모리 방식과 메시지 전달 방식으로 나뉜다 

### 공유 메모리 
공유 메모리 방식에서는 프로세스들이 주소 공간의 일부를 공유하는데, 이 공유한 메모리 영역에 읽기/쓰기를 통해서 통신을 수행한다. 

**방식** 
- 프로세스가 공유 메모리 할당을 커널에 요청하면 커널은 해당 프로세스에 메모리 공간을 할당해준다. 공유 메모리 영역이 구축된 이후에는 모든 접근이 일반적인 메모리 접근으로 취급되기 때문에 더 이상 커널의 도움없이도 각 프로세스들이 해당 메모리 영역에 접근할 수 있다.


**장점**
- 공유 메모리 방식은 프로세스간의 통신을 수월하게 만들고, 커널 의존서이 낮아 속도가 빠르다. 또, 유저 레벨에서 IPC가 가능하기 때문에 통신이 자유롭다

**단점**
- 동시에 같은 메모리 위치에 접근하게 되면 일관성 문제가 발생할 수 있다. 커널은 이 부분에 대허 관여하지 않기 때문에 프로세스끼리 직접 공유 메모리 접근에 대한 동기화 문제를 책임져아 한다

### 메시지 전달
메시지 전달 방법은 커널을 통해 시스템 콜을 전달하는 방식을 사용하여 구현된다. 

**방식** 
- 커널을 통해 send(message)와 receive(message)라는 두 가지 연산을 제공받는다. 예를 들어 프로세스1이 커널로 메시지를 보내면, 커널이 프로세스2에게 메시지를 보내주는 방식으로 동작한다.


**장점** 
- 메모리 공유보다는 속도가 느리지만, 충돌을 회피할 필요가 없기 때문에 적은양의 데이터를 교환하는 데 유용하며, 구현(대표적으로 pipe, socket, message queue 등)하기가 쉽다는 장점을 갖는다.

**단점** 
- 커널을 이용하기 때문에, 시스템 콜(System call)이 필요하며 이로 인해 오버헤드가 발생한다. 매번 커널을 통하여 정보/메세지를 전달하기 위해 두 번 복사해야 해 매번 시스템 콜을 사용해야한다.


### IPC 종류

**공유 메모리**

여러 프로세스에 동일한 메모리 블록에 대한 접근 권한이 부여되어 프로세스가 서로 통신할 수 있도록 공유 메모리를 생성해 통신하는 것을 말한다. 메모리 자체를 공유하는 방식이라 불필요한 데이터 복사에 의한 오버헤드가 발생하지 않아 가장 빠르다 

**파일**

디스크에 저장된 데이터 또는 파일 서버에서 제공한 데이터를 말한다

**소켓**

동일한 컴퓨터의 다른 프로세스나 네트워크의 다른 컴퓨터로 네트워크 인터페이스를 통해 전송하는 데이터를 의미하며 TCP와 UDP가 있다

**익명 파이프**

![image](https://github.com/sxunea/CS-Study/assets/81434152/70828cf2-15a6-4346-978d-d12a89463ec4)

주로 부모, 자식간의 단방향 통신에 사용된다

프로세스 간에 FIFO 방식으로 읽히는 임시 공간인 파이프를 기반으로 데이터를 주고 받으며, 단방향 방식의 읽기 전용, 쓰기 전용 파이프를 만들어서 작동하는 방식이다

**메시지 큐**

패킷 단위로 작동하며, 부모 자식 간의 관계가 아니더라도 가능하다

메시지 큐에 쓸 데이터에 번호를 붙임으로써 다수의 프로세스가 동시에 데이터를 쉽게 다룰 수 있다. 비동기 방식이기에 방대한 처리량이 있다면 큐에 넣은 후 나중에 처리할 수 있다.


## 멀티 스레드

스레드는 하나의 프로세스 내에 있는 실행 흐름이다. 그리고 **멀티 스레드**는 하나의 프로세스 안에 여러개의 스레드가 있는 것을 말한다. 따라서 하나의 프로그램에서 두가지 이상의 동작을 동시에 처리하도록 하는 행위가 가능해진다

![image](https://github.com/sxunea/CS-Study/assets/81434152/86d82527-b696-43b2-9e5f-ac5c32b8dbdc)

코드, 힙, 스택, 데이터를 각각 생성하는 멀티 프로세스와 달리 멀티 스레드는 **코드, 데이터, 힙은 공유하고 스택은 각각** 생성한다

프로세스를 이용하여 동시에 처리하던 일을 스레드로 구현할 경우 메모리 공간과 시스템 자원 소모가 줄어들게 된다. 스레드 간의 통신이 필요한 경우에도 별도의 자원을 이용하는 것이 아니라 전역 변수의 공간 또는 동적으로 할당된 공간인 힙 영역을 이용하여 데이터를 주고받을 수 있다.

그렇기 때문에 프로세스 간 통신 보다 더 간단하고, 빠른 멀티 스레딩을 활용해 스레드 간의 통신을 자주 사용한다

하지만, 멀티 프로세스 기반으로 프로그래밍할 때는 프로세스 간 공유하는 자원이 없기 때문에 동일한 자원에 동시에 접근하는 일이 없었지만 멀티 스레딩을 기반으로 할 땐 공유하는 부분이 있기 때문에 **동기화 작업**이 필요하다


