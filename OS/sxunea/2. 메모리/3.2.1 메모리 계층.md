# 3.2.1 메모리 계층
CPU가 메모리에 더 빠르게 접근하게 하기 위해 메모리를 계층화 한다

![Un3titled](https://github.com/sxunea/CS-Study/assets/81434152/5f9bb189-8170-40b6-9a4c-ee6594babdc9)

- **레지스터** : CPU 안에 있는 작은 메모리로, 휘발성과 속도가 가장 빠르며 기억 용량이 가장 적다

- **캐시** : L1, L2 캐시를 가리킨다. 휘발성, 속도 빠름, 기억 용량이 적다

- **주기억장치** : RAM

- **보조기억장치** : HDD, SSD를 가리키며 비휘발성, 속도 낮음, 기억 용량이 많다


## 레지스터 

**레지스터**란 CPU 안에 있는 매우 빠른 임시 기억 장치이다

CPU는 자체적으로 데이터를 저장할 방법이 없으므로 메모리로 직접 데이터를 전송할 수 없다. 따라서 레지스터를 거쳐 데이터를 전달한다


## 캐시
**캐시란** 데이터를 미리 복사해 놓는 임시 저장소이자 빠른 장치와 느린 장치에서 속도 차이에 따른 병목 현상을 줄이기 위한 메모리를 말한다. 이를 통해 데이터를 접근하는 시간이 오래 걸리는 경우를 해결하고, 무언가를 다시 계산하는 시간을 절약할 수 있다.

CPU에서는 이런 캐시가 CPU 코어(고속)와 메모리(CPU에 비해 저속) 사이에서 **속도 차에 따른 병목 현상을 완화**하는 역할을 한다.

### CPU 캐시
대용량의 메인 메모리 접근을 빠르게 하기 위해 CPU 칩 내부나 바로 옆에 탑재하는 작은 메모리이며, 크기는 보통 수십 KByte ~ 수백 KByte

- L1 캐시 : CPU 칩안에 내장되어 데이터 사용/참조에 가장 먼저 사용된다

- L2 캐시 :  용도와 역할은 L1 캐시와 비슷하지만 속도는 그보다 느리며, CPU 회로판에 별도의 칩으로 내장된다

### 지역성의 원리

캐시는 속도가 빠르지만 비싸고, 용량이 적다. 따라서 이러한 캐시가 효율적으로 동작하려면, 캐시의 **적중율**(Hit-rate)를 극대화 시켜야 한다.

이를 위해 캐시의 지역성을 이용한다. 지역성이란, 데이터 접근이 시간적,공간적으로 가깝게 일어나는 것을 의미한다. 이의 전제 조건으로 프로그램은 모든 코드나 데이터를 균등하게 접근 하지 않는다는 특성을 기본으로 한다.

즉, **지역성**이란 기억장치 내의 정보를 균일하게 접근하는 것이 아닌 **어느 한 순간에 특정 부분을 집중적으로 참조**하는 특성이다

### 지역성의 종류
**시간적** 지역성

- 최근 사용한 데이터에 다시 접근하려는 특성

- 메모리 상의 같은 주소에 여러 차례 읽기 쓰기를 수행할 경우, 상대적으로 작은 크기의 캐시를 사용해도 효율성을 꾀할 수 있다

**공간적** 지역성

- 최근 접근한 데이터를 이루고 있는 공간이나 그 가까운 공간에 접근하는 특성

- 특정 데이터와 가까운 주소가 순서대로 접근되었을 경우, CPU 캐시나 디스크 캐시의 경우 한 메모리 주소에 접근할 때 그 주소뿐 아니라 해당 블록을 전부 캐시에 가져오게 된다

- 이때 메모리 주소를 오름차순이나 내림차순으로 접근한다면,캐시에 이미 저장된 같은 블록의 데이터를 접근하게 되므로 캐시의 효율성이 크게 향상된다


### 캐시 히트와 캐시 미스

**캐시 히트** : 캐시에서 원하는 데이터를 찾은 경우

**캐시 미스** : 해당 데이터가 캐시에 없어서 메인 메모리로 가서 데이터를 찾아야 하는 경우

캐시 히트는 위치도 가깝고 **CPU 내부 버스**를 기반으로 작동해 빠르지만, 캐시 미스가 발생하면 메모리까지 가서 가져와야 하므로, 이는 **시스템 버스**를 기반으로 해 느리다. 

### 캐시 매핑
**캐시매핑**이란, 캐시가 히트되기 위해 매핑하는 방법을 말하며 CPU의 레지스터와 주 메모리(RAM) 간에 데이터를 주고받을 때를 기반으로 설명한다

|이름|설명|
|------|---|
|직접 매핑|주기억장치의 블록들이 지정된 한 개의 캐시 라인으로만 매핑하는 방식(순서 일치)|
|연관 매핑|순서를 일치 시키지 않고 관련있는 캐시와 메모리를 매핑하는 방식|
|집합 연관 매핑|순서는 일치 시키지만 집합을 둬서 저장하면서 블록화 시키는 방식|

직접 매핑은 빠르지만 충돌 가능성이 높고, 연관 매핑은 충돌 가능성은 적지만 탐색 속도가 느리다




