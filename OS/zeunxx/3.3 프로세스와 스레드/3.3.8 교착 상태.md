# 교착 상태 deadlock

두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태
= 작업에 필요한 자원을 얻지 못해 무한정 대기하는 상태

ex) 프로세스 A가 프로세스 B의 어떤 자원을 요청할 때 츠로세스 B도 프로세스 A가 점유하는 자원을 요청하는 것

## 교착상태의 원인

- 상호배제: 한 프로세스가 자원을 독점하며 다른 프로세스는 접근이 불가
- 점유대기: 특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태
- 비선점: 다른 프로세스의 자원을 강제적으로 가져올 수 없음
- 환형대기: 프로세스 A는 프로세스 B의 자원을 요구하고, 프로세스 B는 프로세스 A의 자원을 요구하는 등 서로가 서로의 자원을 요구하는 상황



<BR>

## 교착상태 해결방법

1. 자원을 할당할 때 애초에 조건이 성립되지 않게 설계
2. 교착 상태 가능성이 없을때만 자원을 할당. 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악하는 **은행원 알고리즘Banker's Algorithm** 사용
3. 교착 상태가 발생하면 사이클이 있는지 찾아보고 이에 관련된 프로세스 한 개씩 제거
4. 교착 상태는 매우 드물게 일어나므로 이를 처리하는 비용이 더 커서 교착상태가 발생하면 사용자가 작업 종료 (현대 운영체제는 이 방식 채택)


<br>

## Banker's Algorithm

총 자원의 양과 현재 할당한 자원의 양을 기준으로 안정 또는 불안정 상태로 나누고 안정 상태로 가도록 자원을 할당하는 알고리즘
- 은행에서 돈을 빌려주듯, 운영체제가 자원을 할당할때 요구한 양만큼 차례로 빌려주는 알고리즘


### 은행원 알고리즘의 한계

- 항상 불안전 상태를 회피해야 하므로 자원 활용도 낮음
- 최대 자원 요구량을 미리 알고 있어야 함
- 자원과 프로세스, 사용자 수가 일정해야 함



<br>

### 안전 상태

각 프로세스가 요구한 만큼 차례로 필요한 자원을 할당할 수 있는 상태

- 적은 자원이 필요한 프로세스부터 차례로 할당하면 교착상태를 회피할 수 있는 상태
- 이를 **안전 순서열**이라 하며, 안전 순서열대로 자원을 할당하고 회수하면 교착상태 발생 x

<br>

### 불안전 상태

각 프로세스가 요구한 자원만큼 할당할 수 없는 상태

- 이미 상당한 자원이 프로세스에 할당된 상태
- 남은 자원으로 프로세스가 요구하는 자원을 충당할 수 없는 경우
- 그러나 불안전 상태 != 교착 상태
- 이미 할당된 프로세스로부터 자원을 회수해서 불안전 상태를 해소할 수 있므며, 다시 안전 상태로 돌아갈 수 있음
  - 자원을 회수할 수 없다면 불안전 상태는 교착상태로 굳어짐

<br><br>

## 교착상태 회복 기법

https://velog.io/@lcy960729/DeadLocks-%EA%B5%90%EC%B0%A9-%EC%83%81%ED%83%9C