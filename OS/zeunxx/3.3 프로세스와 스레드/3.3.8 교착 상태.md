# 교착 상태 deadlock

두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태
= 작업에 필요한 자원을 얻지 못해 무한정 대기하는 상태

ex) 프로세스 A가 프로세스 B의 어떤 자원을 요청할 때 츠로세스 B도 프로세스 A가 점유하는 자원을 요청하는 것

## 교착상태의 원인

- 상호배제: 한 프로세스가 자원을 독점하며 다른 프로세스는 접근이 불가
- 점유대기: 특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태
- 비선점: 다른 프로세스의 자원을 강제적으로 가져올 수 없음
- 환형대기: 프로세스 A는 프로세스 B의 자원을 요구하고, 프로세스 B는 프로세스 A의 자원을 요구하는 등 서로가 서로의 자원을 요구하는 상황



<BR>

## 교착상태 해결방법

1. 예방
2. 회피
3. 탐지
4. 복구


<br><br>

### 1️⃣ 교착상태 예방

1. 상호배제 부정: 불가능
2. 점유 대기 부정
   - 모든 자원을 실행 전 확보 = 대기 없음 → 자원의 활용도 낮음
   - 자원을 갖고 있지 않은 경우만 요청 = 점유 없음 → 기아상태 발생 가능성 증가
3. 비선점 부정: 할당 받을 수 없는 자원 요청시 강제 반환
   - 선점은 상태의 보존과 이의 복구 필요 = 입출력장치, 뮤텍스, 세마포어에 적용 어려움
4. 환형대기 부정: 자원 유형에 증가하는 일련번호 부여, 번호가 증가하는 순으로만 자언요청하게 강제 = 비대칭 해결안 = 공평하지 않음

➡ 교착상태 예방은 자원의 활용도를 낮게하고 시스템의 처리량 감소 or 기아상태 발생시킬 수 있음



<br><br>

### 2️⃣ 교착상태 회피

프로세스 일생동안 자원요청에 대한 더 많은 정보를 미리 제공할 것 요구. 추가적인 지식 가지고, 할당하지 않은채 기다릴지 말지 결정

- 현재의 요구가 만족될 수 있는지, 미래의 가능한 교착 상태를 회피하기 위해 기다려야 하는지 결정 가능



<br>

**안정 상태**

각 프로세스가 요구한 만큼 차례로 필요한 자원을 할당할 수 있는 상태

- 적은 자원이 필요한 프로세스부터 차례로 할당하면 교착상태를 회피할 수 있는 상태
- 이를 **안정 순열**이라 하며, 안전 순서열대로 자원을 할당하고 회수하면 교착상태 발생 x

<br>

**불안정 상태**

각 프로세스가 요구한 자원만큼 할당할 수 없는 상태

- 이미 상당한 자원이 프로세스에 할당된 상태
- 남은 자원으로 프로세스가 요구하는 자원을 충당할 수 없는 경우
- 그러나 불안전 상태 != 교착 상태
- 이미 할당된 프로세스로부터 자원을 회수해서 불안전 상태를 해소할 수 있므며, 다시 안전 상태로 돌아갈 수 있음
  - 자원을 회수할 수 없다면 불안전 상태는 교착상태로 굳어짐

<br><br>

**Banker's Algorithm**

총 자원의 양과 현재 할당한 자원의 양을 기준으로 안정 또는 불안정 상태로 나누고 안정 상태로 가도록 자원을 할당하는 알고리즘
- 은행에서 돈을 빌려주듯, 운영체제가 자원을 할당할때 요구한 양만큼 차례로 빌려주는 알고리즘

<br>

**은행원 알고리즘의 한계**

- 항상 불안전 상태를 회피해야 하므로 자원 활용도 낮음
- 최대 자원 요구량을 미리 알고 있어야 함
- 자원과 프로세스, 사용자 수가 일정해야 함

<br><br>

### 3️⃣ 교착상태 탐지

교착상태를 검사하는 알고리즘 주기적으로 수행

- 회피: **할당을 가정**하고 안정 순열 존재 여부를 통해 교착상태 예측
- 탐지: **현재의 할당과 요청**간의 교착상태 있는지 체크

<br>

### 4️⃣ 교착상태 복구

- 프로세스 종료 후 자원 회수

    교착상태 프로세스 모두 중지 or 교착상태 제거될 때까지 한 프로세스씩 중지

- 교착상태에 있는 하나의상의 프로세스들로부터 자원 선점
    
    교착상태에 있는 프로세스가 가진 자원을 계속 선점해 다른 프로세스에게 주는 방식
    - 후퇴(rollback) 필요: 안정상태로 후퇴하고 그 상태로부터 다시 시작
    - 기아 발생고려: 특정 프로세스의 자원만 계속 선점되는 경우가 발생하지 않아야 함
      - ➡ 각 프로세스는 작은 유한 횟수만 희생자로 선정되게 해, 희생 횟수를 비용에 반영