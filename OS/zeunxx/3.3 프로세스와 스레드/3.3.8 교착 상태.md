# 교착 상태 deadlock

두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태
= 작업에 필요한 자원을 얻지 못해 무한정 대기하는 상태

ex) 프로세스 A가 프로세스 B의 어떤 자원을 요청할 때 츠로세스 B도 프로세스 A가 점유하는 자원을 요청하는 것

## 교착상태의 원인

- 상호배제: 한 프로세스가 자원을 독점하며 다른 프로세스는 접근이 불가
- 점유대기: 특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태
- 비선점: 다른 프로세스의 자원을 강제적으로 가져올 수 없음
- 환형대기: 프로세스 A는 프로세스 B의 자원을 요구하고, 프로세스 B는 프로세스 A의 자원을 요구하는 등 서로가 서로의 자원을 요구하는 상황



<BR>

## 교착상태 해결방법

1. 예방
2. 회피
3. 탐지
4. 무시


<br><br>

### 1️⃣ 교착상태 예방

상호배제와 비선점을 예방하긴 어렵고, 점유와 대기, 원형 대기는 프로세스의 작업 방식을 제한하고 자원 낭비가 있어 사용하기 어려움

- 상호배제 예방

    시스템 내에 있는 독점적으로만 사용 가능한 자원을 없애버리는 방법

    but 현실적으로 모든 자원을 고유할 수 없으므로 불가능


- 비선점 예방

    모든 자원을 빼앗을 수 있도록 만드는 방법

    but 현실적으로 불가능 = 임계 구역을 보호해야 함

- 점유와 대기 예방

    프로세스가 자원을 점유한 상태에서 다른 자원을 기다리지 못하게 하는 방법 = 프로세스는 초기에 사용할 모든 자원을 한번에 점유하거나 아니면 자원을 모두 반납해야 하는 방식


## Banker's Algorithm

총 자원의 양과 현재 할당한 자원의 양을 기준으로 안정 또는 불안정 상태로 나누고 안정 상태로 가도록 자원을 할당하는 알고리즘
- 은행에서 돈을 빌려주듯, 운영체제가 자원을 할당할때 요구한 양만큼 차례로 빌려주는 알고리즘


### 은행원 알고리즘의 한계

- 항상 불안전 상태를 회피해야 하므로 자원 활용도 낮음
- 최대 자원 요구량을 미리 알고 있어야 함
- 자원과 프로세스, 사용자 수가 일정해야 함



<br>

### 안전 상태

각 프로세스가 요구한 만큼 차례로 필요한 자원을 할당할 수 있는 상태

- 적은 자원이 필요한 프로세스부터 차례로 할당하면 교착상태를 회피할 수 있는 상태
- 이를 **안전 순서열**이라 하며, 안전 순서열대로 자원을 할당하고 회수하면 교착상태 발생 x

<br>

### 불안전 상태

각 프로세스가 요구한 자원만큼 할당할 수 없는 상태

- 이미 상당한 자원이 프로세스에 할당된 상태
- 남은 자원으로 프로세스가 요구하는 자원을 충당할 수 없는 경우
- 그러나 불안전 상태 != 교착 상태
- 이미 할당된 프로세스로부터 자원을 회수해서 불안전 상태를 해소할 수 있므며, 다시 안전 상태로 돌아갈 수 있음
  - 자원을 회수할 수 없다면 불안전 상태는 교착상태로 굳어짐

<br><br>

