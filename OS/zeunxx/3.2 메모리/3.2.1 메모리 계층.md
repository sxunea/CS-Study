# 메모리 계층


![image](https://github.com/zeunxx/algorithm/assets/81572478/a818e68d-ae25-4d40-ac9b-904625eba663)

- 메모리를 필요에 따라 여러 종류로 나누어 둠
    - **CPU가 메모리에 더 빨리 접근 가능하게 함**
    - 상황에 맞게 여러 저장 장치를 각각 사용할 수 있도록 해 저렴하고 성능 좋은 컴퓨터를 구현하는 설계

<BR>


## 레지스터

CPU가 요청을 처리하는데 필요한 데이터를 일시적으로 저장하는 기억장치 

![image](https://github.com/zeunxx/algorithm/assets/81572478/c3069660-8918-4c53-adb9-678a5555d02b)

- 컴퓨터에서 4대 주요 기능(기억, 해석, 연산, 제어)를 관할하는 장치
- CPU는 자체적으로 데이터를 저장할 방법이 없어 메모리로 직접 데이터를 전송할 수 없음
    
    ➡️ 연산을 위해 반드시 레지스터를 거쳐야 하며, 이를 위해 레지스터는 특정 주소를 가리키거나 값을 읽어올 수 있음

- 프로세서에 위치한 고속 메모리로, 프로세스가 바로 사용할 수 있는 데이터(소량의 데이터, 처리중인 중간 결과 등)을 담고 있는 영역 


<BR>

**💡 CPU 내부 레지스터 종류**

|종류|설명|
|------|---|
|프로그램 계수기 (PC, Program Counter)|다음에 실행할 명령어의 주소를 가지고 있는 레지스터|
|누산기 (AC, ACcumulator)|연산 결과 데이터를 일시적으로 저장하는 데이터|
|명령어 레지스터 (IR, Instruction Register)|현재 수행중인 명령어를 가지고 있는 레지스터|
|상태 레지스터 (SR, Status Register)|현재 CPU의 상태를 가지고 있는 레지스터|
|메모리 주소 레지스터 (MAR, Memory Address Register)|메모리로부터 읽어오거나 메모리에 쓰기 위한 주소를 가지고 있는 레지스터|
|메모리 버퍼 레지스터 (MBR, Memory Buffer Register)|메모리로부터 읽어온 데이터 또는 메모리에 써야할 데이터를 가지고 있는 레지스터|
|입출력 주소 레지스터 (I/O AR, I/O Address Register)|입출력 장치에 따른 입출력 모듈의 주소를 가지고 있는 레지스터|
|입출력 버퍼 레지스터 (I/O BR, I/O Buffer Register)|입출력 모듈과 프로세서 간의 데이터 교환을 위해 사용되는 레지스터|


<BR>

<br>

## 캐시

데이터나 값을 미리 복사해 놓는 임시 장소

- 시스템의 효율성을 위해 사용
    - 캐시의 접근 시간에 비해 원래 데이터를 접근하는 시간이 오래 걸리는 경우 = 캐시 접근 시간이 빠를때
    - 값을 다시 계산하는 시간을 절약하고 싶은 경우


- 속도가 빠른 장치와 느린 장치 사이에서 속도차에 따른 병목 현상을 완화하기 위한 범용 메모리 

- **캐싱** : 캐시라고 하는 좀 더 빠른 메모리 영역으로 데이터를 가져와서 접근하는 방식

<BR>

**💡 CPU 내부 레지스터 종류**

1️⃣ CPU 캐시

- 대용량의 메인 메모리 접근을 빠르게 하기 위해 CPU 칩 내부나 바로 옆에 탑재하는 작은 메모리
- 하드웨어를 통해 관리

<BR>

1. L1 캐시 : 일반적으로 CPU 칩 안에 내장되어 데이터 사용 및 참조에 가장 먼저 사용되는 캐시 메모리
2. L2 캐시 : L1 캐시 메모리와 비슷
    - 속도 : L1 캐시 > L2 캐시 > 일반메모리(RAM)
3. L3 캐시 : L1, L2 캐시와 동일한 원리
    - 대부분 CPU가 아닌 메인보드에 내장

<bR>
- 디스크 캐시(디스크 버퍼) : 하드 디스크에 내장된 작은 컴퓨터(디스크 제어, 외부와의 인터페이스 기능을 함)가 소유한 작은 메모리(디스크에 입출력된느 데이터를 저장하는 작은 메모리)

<BR>

- 지역성
    - 데이터 접근이 시간적/공간적으로 가깝게 일어나는 것
    - 캐시가 효율적으로 동작하기 위해서는 캐시가 저장할 데이터가 지역성을 가져야 함

    |종류|설명|
    |------|---|
    |시간적 지역성|특정 데이터가 한 번 접근되었을 경우, 가까운 미래에 또 한 번 데이터에 접근할 가능성 높음|
    |공간적 지역성|액세스 된 기억장소와 인접한 기억장소가 액세스 될 가능성이 높음|


<BR>

### 캐시 히트, 캐시 미스

![image](https://github.com/zeunxx/algorithm/assets/81572478/16a0069e-0093-42ec-8824-1c5a7cb5d968)


- 캐시 히트 : CPU가 참조하고자 하는 메모리가 캐시에 존재하는 경우
    - CPU 내부 버스를 기반으로 작동하므로 빠름
- 캐시 미스 : CPU가 참조하고자 하는 메모리가 캐시에 존재하지 않을때 
    - 시스템 버스를 기반으로 작동하므로 느림

- 캐시 매핑: 캐시가 히트되기 위해 매핑하는 방법, CPU의 레지스터와 주메모리(RAM)간의 데이터를 주고받을때 기반
    - 레지스터는 메인메모리에 비해 굉장히 작고, 메인메모리는 매우 크므로 작은 레지스터가 캐시 계층으로 역할을 잘 하려면 매핑 방법이 중요

    |종류|설명|
    |------|---|
    |직접 매핑|메모리 주소와 캐시의 순서를 일치시켜 지정된 캐싱라인으로만 매핑. 메모리의 특정 블럭은 특정 캐싱라인에만 저장. 구현 간단하고 빠르지만, 충돌로 인한 잦은 스와핑이 발생할 가능성이 높아 성능이 제한될 수 있음|
    |연관 매핑|순서를 일치시키지 않고 필요한 메모리 값을 캐시의 어디든지 저장. 찾는 과정이 복잡하고 느리지만 충돌이 적으며 필요한 캐시 위주로 저장하기에 적중률 높음|
    |집합 연관 매핑|집합간의 순서는 일치시키는 반면 집합 내에서는 순서를 일치시키지 않고 편하게 저장. 직접 매핑과 연관 매핑의 장점만 취함|


<BR>

### 웹 브라우저의 캐시

1. 쿠키 : 만료기한이 있는 키-값 저장소
2. 로컬 스토리지 : 만료기한이 없는 키-값 저장소
3. 세션 스토리지 : 만료기한이 없는 키-값 저장소


> 데이터베이스의 캐싱 계층
>
> 메인 데이터베이스 위에 레디스redis 데이터베이스 계층을 캐싱 계층으로 두어 성능을 향상시킬 수 있다.

<BR>

✅ 캐시와 레지스터의 차이점

캐시는 cpu와 별도로 있는 공간이며, 메인 메모리와 cpu 간의 속도 차이를 극복하기 위한 것이라는 것이고
레지스터는 cpu 안에서 연산을 처리하기 위하여 데이터를 저장하는 공간 이라는 것입니다. 


<BR><br>

## 주 기억장치 - 메인 메모리 RAM

주 기억장치
- 컴퓨터에서 수치, 명령, 자료 등을 기억하는 컴퓨터 하드웨어 장치


### RAM (Random Access Memory)
휘발성 기억장치
- 컴퓨터가 빠른 액세스를 하기 위해 데이터를 단기간 저장하는 구성요소
- 사용자가 요청하는 프로그램이나 문서를 스토리지 디스크에서 메모리로 로드해 각각의 정보에 액세스
- 전원이 유지되는 동안 CPU의 연산 및 동작에 필요한 모든 내용이 저장    
- 전원 종료시 기억된 내용 삭제
- Random Access : 어느 위치에서든 똑같은 속도로 접근해 읽고 쓸 수 있음

<br>

### ROM (Read Only Memory)
고정 기억 장치
- 컴퓨터에서 지시사항을 영구히 저장하는 비휘발성 메모리
- 전원 종료시 기억된 내용 유지
- 변경 가능성이 희박한 기능 및 부품에 사용
    - 소프트웨어 : 초기 부팅 관련 부분
    - 하드웨어 : 프린터 작동에 관여하는 펌웨어 명령 등



<br>

## 보조 기억 장치 - 하드 디스크 드라이브 HDD, SSD

하드 디스크, 하드 드라이브, 고정 디스크

비휘발성, 순차 접근이 가능한 컴퓨터의 보조 기억 장치
- 비휘발성 데이터 저장소 가운데 가장 대중적이며 용량 대비 가격이 가장 저렴

- 원리
    - 보호 케이스 내부의 플래터 회전 → 플래터에 자기 패턴으로 정보 기록
    - 플래터 표면의 코팅된 자성체에 데이터 기록
    - 회전하는 플래터 위에 부상하는 입출력 헤드에 의해 자기적으로 데이터 기록 및 조회 가능